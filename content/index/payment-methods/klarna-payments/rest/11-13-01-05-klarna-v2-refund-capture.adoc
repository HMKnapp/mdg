:txTypeName: refundCapture

[#KlarnaV2_TransactionTypes_refundCapture]
==== _refund-capture_

Use this transaction type to trigger a refund if a consumer returns all or some items. 

You can refund

* the **total order amount:** If you do not send order items within the _refund-capture_ request, the total order amount will be refunded. 
* a **partial order amount:** Send the returned order items information within the _refund-capture_ request to trigger a partial order amount.

//-

You cannot 

* bundle refunds. You have to create a _refund-capture_ transaction for each _capture-authorization_ transaction separately.
* change the price of the ordered items, otherwise the _refund-capture_ transaction will be rejected.
//-

To refer to a specific _capture-authorization_, you need the ``parent-transaction-id``, which is the ``transaction-id`` of the preceding _capture-authorization_ response.

[#KlarnaV2_TransactionTypes_refundCapture_Workflow]
===== _refund-capture_ Workflow

include::{root}/images/Klarnav2_workflow_refundAuthorization.svg[]

. -> Send a _refund-capture_ request. This request must contain the ``parent-transaction-id``. Enter the ``transaction-id`` of the preceding _capture-authorization_ response.

 ** If the _refund-capture_ request does not contain order items, _{payment-gateway}_ refunds the total order amount, i.e. all order items of the preceding _capture-authorization_ transaction are refunded.
. _{payment-gateway}_ forwards the request to _Klarna_. 
. _Klarna_ returns the refund result.
. _{payment-gateway}_ sends you the _refund-capture_ response which contains the status code.
. -> Process the _refund-capture_ response.

//-

[#KlarnaV2_TransactionTypes_refundCapture_Fields]
===== _refund-capture_ Fields

Fields can be **M**andatory or **O**ptional.

[%autowidth,stripes=none]
[cols="m,,,,"]
|===
|Field |<<APIRef_FieldDefs_Cardinality, M/O>> |Data Type |Size |Description


|merchant-account-id 
|O 
|String 
|36 
|A unique identifier assigned to every merchant account (by {payment-provider-name}).

|request-id 
|M 
|String 
|150 
a|A unique identifier assigned by the merchant
to each request. Used when searching for or referencing it later.

As the request ID must be unique, ``{{$guid}}`` serves as a placeholder; Postman
uses it to generate a random ``request-id`` for testing.

Allowed characters:  ``[a-z0-9-\_]``.

|transaction-type 
|M 
|String
|30 
|The requested transaction type. Set this field to `refund-capture`.

|parent-transaction-id
|M
|String 
|36
|Enter the ``transaction-id`` of the preceding _capture-authorization_.

|requested-amount  
|M
|Numeric
|18,3
a|Total order amount to be reserved. The number of decimal places depends on the currency. 

The requested amount must not exceed the amount of the preceding _capture-authorization_ transaction.

Use ``.`` (decimal point) as separator.

|[[KlarnaV2_TransactionTypes_refundCapture_Fields_requestedAmount_currency]]requested-amount@currency 
|M 
|String
|3 
a|The <<KlarnaV2_CountriesCurrencies, currency>> of the requested/contested
transaction amount. +
Format: 3-character abbreviation according to ISO 4217.

|order-detail
|O
|String
|
|Detailed description of the (reason for the) refund.

|order-number	
|Response only 
|String
|255 
|Order number of the merchant as sent in the initial _authorization_ or preceding _adjust-authorization_. Shows as "order number" on _Klarna_'s payment confirmation page.

|parent-transaction-amount
|Response only
|String 
|18,3
|``requested-amount`` of the preceding _capture-authorization_.

|parent-transaction-amount@currency
|Response only
|String 
|3
|``requested-amount@currency`` of the preceding _capture-authorization_.

|locale	
|Response only 
|String
|5 
|A 5-letter code that indicates what <<KlarnaV2_Locales, language>> the payment page is rendered in (RFC 1766).

|transaction-id 
|Response only 
|String
|36
|A unique identifier assigned for every transaction. Generated by {payment-provider-name}. Used when searching for or referencing it later.

|transaction-state 
|Response only 
|String
|12
a|Transaction status. +
Possible values: 

  - ``success``
  - ``failed``

//-

|completion-time-stamp
|Response only 
|DateTime
|
|The timestamp documents the time and date when the transaction was completed.

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_paymentMethod.adoc[tags=**;!mandatory;!MO;!recurring;!adjust-authorization;!initialAuthorization]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_notifications.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_accountHolder_responseOnly.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_accountHolderAddress_responseOnly.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_shipping_followUp.adoc[tags="**;!adjust-capture;capture-authorization"]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_orderItems.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_status.adoc[]

|===

[#KlarnaV2_TransactionTypes_refundCapture_Samples]
===== _refund-capture_ Samples

._refund-capture_ Request
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_refundCapture_request.xml[]
----

NOTE: {{txnId}} serves as placeholder. Enter the ``transaction-id`` of the preceding _capture-authorization_.

._refund-capture_ Response
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_refundCapture_response.xml[]
----

:!txTypeName:

//-