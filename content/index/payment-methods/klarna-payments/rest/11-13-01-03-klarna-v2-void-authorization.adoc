//:payment-method-name: Klarna

[#KlarnaV2_TransactionTypes_voidAuthorization]
==== _void-authorization_

Use this transaction type to cancel an order, e.g. if the goods or services are not available
or the consumer wants to cancel their order. We recommend to cancel authorizations to avoid any influence on risk decisions for further payments.


You can cancel

* only authorized amounts that have not yet been completely captured.
* the **total order amount**.
* a **partial order amount**. If the order has been partially captured, a _void-authorization_ cancels only the part of the preceding _authorization_ that has not yet been captured.

//-

NOTE: Once canceled, you can no longer process the order. The initial authorization/reservation is no longer valid.

To refer to a specific _authorization_, _adjust-authorization_ or _pending-authorization_, you need the ``parent-transaction-id``, which is the ``transaction-id`` of the preceding transaction.

[#KlarnaV2_TransactionTypes_voidAuthorization_Workflow]
===== _void-authorization_ Workflow

[mermaid,Klarnav2_workflow_voidAuthorization,svg,subs=attributes+]
----
sequenceDiagram
    participant M as Merchant
    participant W as WPG
    participant K as Klarna
M-->>M: cancels order
M->>W: sends "void-authorization" request
W->>K: creates "void-authorization" transaction
W-->>W: capture check
    alt partial capture before
        W->>K: releases remaining auth. request
        K->>W: releases remaining order
    else no partial capture before
        W->>K: cancels authorization request
        K->>W: cancels authorization
    end
W->>M: creates/sends response
----

. -> Send a _void-authorization_ request. This request must contain the ``parent-transaction-id``. Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_ that is to be canceled.
. _{payment-gateway}_ checks if parts of this order have already been captured:
  ** If yes: _{payment-gateway}_ sends a _void-authorization_ request for the uncaptured order items to _Klarna_. 
  ** If no: _{payment-gateway}_ sends a _void-authorization_ request for the total order amount to _Klarna_. 
. _Klarna_ approves or rejects the void request and returns the result.
. _{payment-gateway}_ sends you the _void-authorization_ response which contains the status code.
. -> Process the _void-authorization_ response.

//-

[#KlarnaV2_TransactionTypes_voidAuthorization_Fields]
===== _void-authorization_ Fields

Fields can be mandatory (M) or optional (O).

[%autowidth]
[cols="e,,,,,"]
|===
|Field |Request |Response |Data Type |Size |Description

|merchant-account-id 
|O 
|M 
|Alphanumeric 
|36 
|A unique identifier assigned
to every merchant account (by {payment-provider-name}).

|request-id 
|M
|M 
|Alphanumeric 
|36 
a|A unique identifier assigned by the merchant
to each request. Used when searching for or referencing it later.

As the request ID must be unique, ``{{$guid}}`` serves as a placeholder; Postman
uses it to generate a random ``request-id`` for testing.

Allowed characters:  ``[a-z0-9-\_]``.

|parent-transaction-id
|M
|M
|Alphanumeric 
|36
|Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_.

|transaction-type 
|M 
|M 
|Alphanumeric
|30 
|The requested transaction type. Set this field to `void-authorization`.

|requested-amount  
|-
|M
|Numeric
|18,3
|Total order amount to be reserved. The number of decimal places depends on the currency. +
The requested amount must be equal to the amount sum of all order items.

Use ``,`` (comma) as separator.

|[[KlarnaV2_TransactionTypes_voidAuthorization_Fields_requestedAmount_currency]]requested-amount@currency 
|-
|M 
|Alphanumeric
|3 
a|The <<KlarnaV2_CountriesCurrencies, currency>> of the requested/contested
transaction amount. +
Format: 3-character abbreviation according to ISO 4217.

|order-detail
|-
|O
|Alphanumeric
|
|Description of the cancelation.

|payment-methods. +
payment-method@name
|O 
|M 
|Alphanumeric
|15 
a|The name of the payment method used for the transaction. 

Possible values: 

  - ``klarna-finance`` for payment in installments (Financing/Slice it)
  - ``klarna-debit`` for _Klarna_ direct debit (Pay now) 
  - ``klarna-transfer`` for _Klarna_ bank transfer (Pay now)
  - ``klarna-paylater`` for _Klarna_ payment on invoive (Pay later)
//-

|locale	
|- 
|M 
|Alphanumeric
|5 
|A 5-letter code which indicates what <<KlarnaV2_Locales, language>> the payment page is rendered in (RFC 1766).

|transaction-id 
|-
|M 
|Alphanumeric
|36
|A unique identifier assigned for every transaction. Generated by {payment-provider-name}. Used when searching for or referencing it later.

|transaction-state 
| -
|M 
|Alphanumeric
|12
a|Transaction status. +
Possible values: 

  - ``success``
  - ``failed``

//-

|completion-time-stamp
|-
|M
|DateTime
|
|The timestamp documents the time and date when the transaction was completed.

|notifications. +
notification-url 
|O 
|M 
|Alphanumeric
|256
|The URL to which _{payment-gateway}_ sends an <<GeneralPlatformFeatures_IPN_NotificationExamples, Instant Payment Notification (IPN)>> for pending reservations or the transaction outcome. It overwrites the notification URL that is set up in your merchant configuration.

5+<.>s|order-items.order-item.
s|Description of a specific order item.

|name 
|-
|M 
|Alphanumeric
|256 
|Name of the item in the shopping basket.

|description 
|-
|O 
|Alphanumeric
|1024 
|Description of the item in the shopping basket.

|article-number 
|-
|O 
|Alphanumeric
|256 
|EAN or other merchant-side article identifier.

|quantity 
|-
|M
|Numeric 
|n/a  
|Total number of this item in the shopping basket.

|amount 
|- 
|M 
|Numeric 
|18,3 
|Item’s price per unit.  +

Use ``,`` (comma) as separator.

|amount@currency 
|-
|M 
|Alphanumeric
|3 
|<<KlarnaV2_CountriesCurrencies, Currency>> of this item's price. Must match the <<KlarnaV2_TransactionTypes_voidAuthorization_Fields_requestedAmount_currency, order currency (requested amount currency)>>. +
Format: 3-character abbreviation according to ISO 4217.

|type
|-
|O
|Alphanumeric
|n/a
a|Order item type. +
Possible values: 

  - ``shipment_fee``
  - ``handling_fee``
  - ``discount``
  - ``physical``
  - ``sales_tax``
  - ``digital``
  - ``gift_card``
  - ``store_credit``

//-

|tax-rate 
|-
|O 
|Numeric
|5,2 
a|Item’s tax rate per unit in percent.

|tax-amount 
|-
|O 
|Numeric
|5,2 
a|Item’s tax value per unit.

|discount	
|-
|O
|Numeric
|18,3 
|The discount value for one order item.  +
Use ``,`` (comma) as separator.

5+<.>s|account-holder.
s|Contains consumer data.

|date-of-birth 
|-
|O 
|Date 
|
|Consumer's date of birth. +
Format: _Klarna_ accepts only ``dd-MM-YYYY`` or ``YYYY-MM-dd``. + 
If you provide a different format, _Klarna_ prompts the consumer to enter their birth date during the payment process.

|first-name 
|-
|O 
|Alphanumeric
|32 
|Consumer's first name.

|last-name 
|- 
|O 
|Alphanumeric
|32 
|Consumer's last name.

|email 
|-
|O 
|Alphanumeric
|64 
|Consumer's email address.

|gender 
|-
|O 
|Alphanumeric
|1 
|Consumer's gender.

|phone 
|-
|O 
|Alphanumeric
|32 
|Consumer's phone number. +
Phone numbers need to be validated. Click <<Klarnav2_phoneNumberValidation, here>> for details.

5+<.>s|account-holder.address.
s|Consumer's address.

|street1 
|-
|O 
|Alphanumeric
|128 
|Street of the consumer's address.

|street2	
|-
|O 
|Alphanumeric
|128 
|House number of the consumer's address.	 

|city 
|-
|O 
|Alphanumeric
|32 
|City of the consumer's address.

|country 
|-
|M 
|Alphanumeric
|3 
|<<KlarnaV2_CountriesCurrencies, Country code>> of the consumer's address.

|postal-code 
|-
|O 
|Alphanumeric
|16 
|Postal/ZIP code of the consumer's address.

5+<.>s|shipping. 
s|Consumer's shipping information.

|first-name 
|-
|O 
|Alphanumeric
|32 
|Recipient's first name.  

|last-name 
|-
|O 
|Alphanumeric
|32 
|Last name of the recipient.

|email 
|-
|O 
|Alphanumeric
|64 
|Email address of the recipient.	

|phone 
|-
|O 
|Alphanumeric
|32 
|The phone number of the recipient. +
Phone numbers need to be validated. Click <<Klarnav2_phoneNumberValidation, here>> for details.

5+<.>s|shipping.address.
s|Consumer's shipping address.

|street1 
|-
|O 
|Alphanumeric
|128 
|Street of the recipient's address.

|street2 
|-
|O 
|Alphanumeric
|128 
|House number of the recipient's address.	 

|house-extension 
|-
|O 
|Alphanumeric
|32 
|House extension of the recipient's address.	 

|city 
|-
|O 
|Alphanumeric
|32 
|City of the recipient's address.

|country 
|-
|O
|Alphanumeric
|3 
|Country code of the recipient's address.

|postal-code 
|-
|O 
|Alphanumeric
|16 
|Postal/ZIP code of the recipient's address.

5+<.>s|statuses.status.
s|Contains information on the status of a specific transaction.

|code
|-
|M
|Alphanumeric
|12
|Transaction status code.

|description
|-
|M
|Alphanumeric
|256
|Transaction status message.

|severity
|-
|M
|Alphanumeric
|20
a|The definition of the status message. Possible values:

- ``information``
- ``warning``
- ``error``

//-

|===

[#KlarnaV2_TransactionTypes_voidAuthorization_Samples]
===== _void-authorization_ Samples

._void-authorization_ Request
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_voidAuthorization_request.xml[]
----

NOTE: {{txnId}} serves as placeholder. Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_ that is to be canceled.

._void-authorization_ Response
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_voidAuthorization_response.xml[]
----

//-