[#PPv2_paylib]
== {payment-page-v2}

[#PPv2_paylib_General]
=== General Information

This is a reference page for _Paylib_. Here you find all the
information necessary for integrating this payment method into
your Hosted and Embedded Payment Page.

.Are you unfamiliar with {payment-page-v2} ({payment-page-v2-abbr})?

NOTE: Visit one of the integration guides
(<<PaymentPageSolutions_PPv2_HPP_Integration, Hosted>>,
<<PaymentPageSolutions_PPv2_EPP_Integration, Embedded>>) for a quick explanation and
a step-by-step guide before continuing.

All <<PPv2, {payment-page-v2-abbr}>> integrations share a
<<PPSolutions_PPv2_Workflow, common process flow>> for creating payments.

<<PPv2_paylib_Samples_debitauth, Below>> you find an example request for the available transaction types
_debit_ and _authorization_, including field list with short descriptions.

For more details on the ``redirect-url``, see the
<<PPSolutions_PPv2_ConfigureRedirects, Configuring Redirects and IPNs for {payment-page-v2-abbr}>> section.

For response verification examples, see
the <<PPSolutions_PPv2_PPv2Security, {payment-page-v2-abbr} Security>> section.

[#PPv2_paylib_About]
=== About _Paylib_

_Paylib_ is a French mobile wallet initiated by a collaboration of major French banks. By linking a credit card to their account, _Paylib_ allows consumers to make purchases without having to re-enter their card details. To pay, consumers have to enter their username, password, and a code generated by the _Paylib_ app.

[#PPv2_paylib_TestCredentials]
=== Test Credentials

Test credentials for transaction types <<PPv2_paylib_TransactionType_debitauth_Create, _debit_>> and <<PPv2_paylib_TransactionType_debitauth_Create, _authorization_>>.

[%autowidth, cols="h,"]
|===
| URL (Endpoint)
| ``\https://{pp-test-endpoint}``
| Merchant Account ID (MAID)
| d79cbe98-cb2c-4882-a16e-47eaeb99ad44
| Username
| 70000-APITEST-AP
| Password
| qD2wzQ_hrc!8
| Secret Key (used for response verification)
| 04ee80a3-a2db-4963-a3ea-07b6daadd093
|===

[#PPv2_paylib_TestCredentials_Additional]
.Test Credentials for the _Paylib_ Environment

[cols="20h,80"]
|===
| User Name | psp-wirecard@wl.net
| Password | password
|===

[#PPv2_paylib_Countries]
=== Countries and Currencies

This table shows the _Paylib_ payment mode and the countries and currencies which
are relevant for _Paylib_.

[%autowidth]
|===
| Payment Mode | <<PaymentMethods_PaymentMode_Wallet, Wallet>>
| Countries    | France
| Currencies   | EUR
|===

[#PPv2_paylib_Transactions]
=== Transaction Types _debit_ and _authorization_

A _debit_ charges the specified amount from the account holder's bank account and marks it for immediate transfer.

An _authorization_ reserves the specified amount from the account holder's bank account for a later transfer.

For a successful transaction:

. Create a payment session (initial request).

. Redirect the consumer to the payment page (initial response URL).

. Highly recommended: Parse and process the payment response.


[#PPv2_paylib_Samples]
=== Samples

_Paylib_ can be used with the transaction types <<PPv2_paylib_TransactionType_debitauth_Create, _debit_>> and <<PPv2_paylib_TransactionType_debitauth_Create, _authorization_>>.

We provide JSON examples for each step of this process. You can find
them below. You need to adapt the field values to your system.

.Request Headers
[cols="20h,80"]
|===
| Authorization
| "Authorization"="Basic" + base64 ("username:password"). Use username and password as given in your
Wirecard contract to base64-encode the authorization.
| Content-Type
| application/json
|===


[#PPv2_paylib_Samples_debitauth]
===  _debit_ and _authorization_ Sample

[#PPv2_paylib_TransactionType_debitauth_Create]
.1. Create a Payment Session (Initial Request)

You can use the following sample for either transaction type. Please enter the desired value (``debit`` or ``authorization``) for ``transaction-type``.

[source,json,subs=attributes+]
----
include::{root}/samples/json/PPv2PaylibTransactionTypeDebitauthCreate_1CreateAPaymentSessionInitialRequest.json[]
----

[%autowidth]
|===
3+|Field (JSON) |Data Type |Cardinality |Size |Description

2+| merchant-account-id
| value
| String
| Mandatory
| 36
| A unique identifier assigned to every merchant account (by Wirecard).

3+| request-id
| String
| Mandatory
| 150
| A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. ``{{$guid}}`` serves as a placeholder for a random request-id. +
Allowed characters: `[a-z0-9-_ ]`

3+| transaction-type
| String
| Mandatory
| n/a
a| The requested transaction type. Available transaction types for _Paylib_:

- `debit`
- `authorization`

//-

.2+| requested-amount
2+| value
| Numeric
| Mandatory
| 18.2
| The full amount that is requested/contested in a transaction. 2 decimal places allowed. +
Use `.` (decimal point) as the separator.
2+| currency
| String
| Mandatory
| 3
a| The currency of the requested/contested
transaction amount. For _Paylib_ payments, the currency must be set to ``EUR``.

Format: 3-character abbreviation according to ISO 4217.

| payment-methods
| payment-method
| name
| String
| Mandatory
| 256
| The name of the payment method used. Set this value to ``paylib``.

.3+| account-holder
2+| first-name
| String
| Optional
| 32
| The first name of the account holder.

2+| last-name
| String
| Optional
| 32
| The last name of the account holder.

2+| email
| String
| Optional
| 64
| The email address of the account holder.

3+| success-redirect-url
| String
| Mandatory
| 2000
a| The URL to which the consumer is redirected after a successful payment, e.g. ``\https://{pp-redirect-url-success}``

3+| cancel-redirect-url
| String
| Mandatory
| 2000
a| The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``

3+| fail-redirect-url
| String
| Mandatory
| 2000
a| The URL to which the consumer is redirected after an unsuccessful payment, e.g. ``\https://{pp-redirect-url-error}``
|===

[#PPv2_paylib_TransactionType_purchase_Redirect]
.2. Redirect the Consumer to the Payment Page (Sample Response URL)

[source,json,subs=attributes+]
----
include::{root}/samples/json/PPv2PaylibTransactionTypePurchaseRedirect_2RtCttPPSRU.json[]
----

[%autowidth]
|===
| Field (JSON) | Data Type | Description

| payment-redirect-url
| String
| The URL which redirects to the payment
form. Sent as a response to the initial request.
|===


At this point, you need to redirect your consumer to
``payment-redirect-url`` (or render it in an _iframe_ depending on your
<<PPv2, integration method>>).

Consumers are redirected to the payment form. There they enter their
data and submit the form to confirm the payment. A payment can be:

- successful (``transaction-state: success``),
- failed (``transaction-state: failed``),
- canceled (``transaction-state: failed``) The consumer canceled the payment before/after submission.

//-

The transaction result is the value of ``transaction-state`` in the
payment response. More details (including the status code) can also be
found in the payment response, in the ``statuses`` object. Canceled
payments are returned as _failed_, but the
``status description`` indicates it was canceled.

In any case (unless the consumer cancels the transaction on a 3rd party
provider page), a base64-encoded response containing payment information
is sent to the configured redirection URL. See
<<PPSolutions_PPv2_ConfigureRedirects, Configuring Redirects and IPNs for {payment-page-v2-abbr}>>
for more details on redirection targets after payment and transaction status
notifications.

You can find a decoded payment response example below.


.3. Parse and Process the Payment Response (Decoded Payment Response)

[source,json,subs=attributes+]
----
include::{root}/samples/json/PPv2PaylibTransactionTypePurchaseRedirect_3ParseAndProcessThePaymentResponseDecodedPaymentResponse.json[]
----

[%autowidth]
|===
2+| Field (JSON) | Data Type | Description

2+| transaction-id
| String
| A unique identifier assigned for every transaction. This information is returned in the response only.

2+| request-id
| String
| A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later.

2+| transaction-type
| String
| The requested transaction type. For _Paylib_ payments, the
transaction-type must be set to `authorization` or `debit`.

2+| transaction-state
| String
a| The current transaction state. +
Possible values:

- ``in-progress``
- ``success``
- ``failed``

//-

Typically, a transaction starts with state ``in-progress`` and finishes with state either ``success`` or ``failed``. This information is returned in the response only.

2+| completion-time-stamp
| YYYY-MM-DD-Thh:mm:ss
| The UTC/ISO time-stamp documents the time and date when the transaction was executed. +
Format: YYYY-MM-DDThh:mm:ss (ISO).

.2+| requested-amount
| currency
| String
| The currency of the requested/contested transaction amount. For _Paylib_ payments, the currency must be set to ``EUR``. +
Format: 3-character abbreviation according to ISO 4217.

| value
| Numeric
| The full amount that is requested/contested in a transaction.

.3+| status
| description
| String
| The description of the transaction status message.

| severity
| String
a| The definition of the status message.

Possible values:

- ``information``
- ``warning``
- ``error``

//-

| code
| String
| Status code of the status message.

2+| authorization-code
| String
| Output code for transaction type ``authorization``.

2+| parent-transaction-id
| String
| The ID of the transaction referenced as a parent.

.2+| card-token
| token-id
| String
| A unique identifier assigned to every card token.

| masked-account-number
| String
| This is the masked card account number of the consumer.

2+| success-redirect-url
| String
| The URL to which the consumer is redirected after a successful payment, e.g. ``\https://{pp-redirect-url-success}``.

2+| processing-redirect-url
| String
| The URL to which the consumer is redirected after completing the payment. This is normally a page on the merchant's website.

| merchant-account-id
| value
| String
| A unique identifier assigned to every merchant account (by Wirecard).

2+| cancel-redirect-url
| String
| The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``.

2+| fail-redirect-url
| String
| The URL to which the consumer is redirected after a failed payment, e.g. ``\https://{pp-redirect-url-error}``.

.3+| account-holder
| first-name
| String
| The first name of the account holder.

| last-name
| String
| The last name of the account holder.

| email
| String
| The email address of the account holder.

.2+| payment-method
| payload
| String
a| Only if `transaction-state` is `success`. This is the input field name of the form that the merchant has to submit to the Paylib URL.

| name
| String
| The name of the payment method used.

2+| api-id
| String
| Identifier of the currently used API.

2+| descriptor
| String
| Description of the transaction for account holder's bank statement purposes.
|===

[#PPv2_paylib_PostProcessing]
=== Post-Processing Operations

WPP is best used to deal with one-off payments (e.g. regular, independent _debit_ transactions) or the initial transaction in a chain of them (e.g. a first _authorization_ in a chain of recurring transactions). However, when it comes to referencing a transaction for any kind of post-processing operation — such as a refund of one of your _debit_ transactions — use our <<RestApi, REST API>> directly.


[#PPv2_paylib_JSONNVP_Field_Reference]
=== JSON/NVP Field Reference

Here you can:

- find the NVP equivalents for JSON fields (for migrating merchants),
- see the structure of a full request (optional fields included).

//-

.JSON Structure for _Paylib_ Requests

[source,json,subs=attributes+]
----
include::{root}/samples/json/PPv2Paylib_JSONNVP_FieldReference_JSON_StructureForPaylibRequests.json[]
----

[#PPv2_paylib_JSON_NVPFields_Request]
[%autowidth]
|===
| Field (NVP) | Field (JSON) | JSON Parent

|merchant_account_id
|value
|merchant-account-id ({ })

|request_id
|request-id
|payment ({ })

|transaction_type
|transaction-type
|payment ({ })

|requested_amount
|value
|requested-amount ({ })

|requested_amount_currency
|currency
|requested-amount ({ })

|payment_method
|payment-method ([ ])/name
|payment-methods ({ })

|first_name
|first-name
|account-holder ({ })

|last_name
|last-name
|account-holder ({ })

|success_redirect_url |success-redirect-url |payment ({ })
|fail_redirect_url |fail-redirect-url |payment ({ })
|cancel_redirect_url |cancel-redirect-url |payment ({ })
|===


.Response-Only Fields

[source,json,subs=attributes+]
----
include::{root}/samples/json/PPv2Paylib_JSON_NVPFieldsRequest_ResponseOnlyFields.json[]
----


[#PPv2_paylib_JSON_NVPFields_Response]
[%autowidth]
|===
| Field (NVP) | Field (JSON) | JSON Parent

|transaction_id
|transaction-id
|payment ({ })

|transaction_state
|transaction-state
|payment ({ })

|completion_time_stamp
|completion-time-stamp
|payment ({ })

|api_id
|api-id
|payment ({ })

|status_description_n
|status ([ {} ])/ description
|statuses ({ })

|status_severity_n
|status ([ {} ])/ severity
|statuses ({ })

|status_code_n
|status ([ {} ])/ code
|statuses ({ })
|===


//-
