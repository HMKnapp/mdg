[#Paylib]
== REST API

_Paylib_ is a type of <<PaymentMethods_PaymentMode_Wallet, Wallet>>.

[#Paylib_Introduction]
[#Paylib_General]

[#Paylib_General_PaymentMode]
=== Countries and Currencies

[width=75%,cols="1h,3",stripes=none]
|===
| Countries    | France
| Currencies   | EUR
|===

[#Paylib_General_Communication]
=== Communication Formats

This table illustrates how _Paylib_ notifications are encoded and which
formats and methods can be used for requests and responses.

[width=75%,stripes=none]
|===
.2+h| Requests/Responses | Format  | XML
                         | Methods | POST

h|IPN Encodement       2+| Please follow the instructions given at <<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===

[#Paylib_TransactionTypes]
=== Transaction Types

Every successful _Paylib_ payment request results in two distinct
transactions in the database:

. one for the _Paylib_ wallet,
. one for _Credit Card_.

//-

For <<Glossary_TransactionType, transaction type>> details look at <<AppendixB,  Transaction Types>>.

[%autowidth]
|===
|Paylib |  |Credit Card |Link to the Sample

|_debit_ |AND |_purchase_ |See <<Paylib_Samples_debit, samples>>.
|===

[#Paylib_TestCredentials]
=== Test Credentials

[cols="30h,35,35"]
|===
| URLs (Endpoints) |For transaction type _debit_. | ``\https://{test-instance-hostname}/engine/rest/payments/``
| Merchant Account ID (MAID) 2+| d79cbe98-cb2c-4882-a16e-47eaeb99ad44
| Username         2+| 70000-APITEST-AP
| Password         2+| qD2wzQ_hrc!8
| Secret Key       2+| 04ee80a3-a2db-4963-a3ea-07b6daadd093 
|===

[#Paylib_TestCredentials_Additional]
==== Additional Test Credentials on Paylib Environment

[cols="30h, 70"]
|===
|Username a|\psp-wirecard@wl.net
|Password |password
|===

[WARNING]
====
When using Postman for testing, you must disable SSL certificate
verification:

. Select *File*/*Settings*/*General*.
. Set *SSL certificate verification* to *OFF*.

//-
====

[#Paylib_Workflow]
=== Workflow

[#Paylib_Workflow_debit]
==== _debit_

*REST API: Standard Checkout*

image::images/11-38-paylib/Paylib_Workflow_debit.png[Paylib Workflow debit]

. The consumer adds items to the shopping basket.
. The consumer selects the payment method _Paylib_.
. The merchant initiates a _debit_ transaction.
. {payment-gateway} sends a response to the merchant
containing the redirect URL and payload information for authentication
in _Paylib_.
. The merchant submits a POST form containing payload information to
the redirect URL and redirects the consumer to _Paylib_.
. The consumer enters their _Paylib_ credentials, selects the
preferred card and confirms the payment.
. {payment-gateway} receives the card information.
. {payment-gateway} processes the transaction with the
merchant's acquirer.
. {payment-gateway} receives the transaction status.
. {payment-gateway} sends the transaction status to the
merchant and redirects the consumer to the merchant.
. The merchant receives the transaction status and displays the
completion of the payment process to the consumer.
. {payment-gateway} sends the _Paylib_ _debit_ notification
to the merchant. 
. {payment-gateway} sends the _Credit Card_ _purchase_ notification to the merchant.

//-

NOTE: Currently, the test environment does not offer polling for the final
transaction status. A status check needs to be integrated
on the merchant side.

[#Paylib_Fields]
=== Fields

The following elements are elements with differeing cardinality from
the <<RestApi_Fields, REST API Fields>> and mandatory (M), optional (O) or conditional \(C) for sending a
request/response for the payment method _Paylib_.

[#Paylib_Fields_debit]
==== _debit_ fields

[%autowidth, cols="v,,,,,,"]
|===
| Field               | Request | Response | Notification | Data Type    | Size | Description

|merchant-account-id |M |M |M |String |36 |The unique identifier for a merchant account.
|transaction-id |  |M |M |String |36 |The transaction-ID is the unique identifier for a transaction. It is generated by the {payment-gateway}.
|request-id |M |M |M |String |150 |This is the unique identifier for the
request. Every single request MUST be unique.
|transaction-type |M |M |M |String |22 |Determines a
transaction's behavior during transaction processing and merchant
settlement. Must be _debit._
|payment-methods/payment-method[@name] |M |M |M |String |9 |The name of
the payment method is _Paylib._
|payment-methods/payment-method[@url] |  |C |  |String |  a|
Only if ``transaction-state`` is ``success``.+
_Paylib_ URL where the consumer is redirected to in order to confirm the
payment.+
This is the URL where the merchant has to send the POST form with data
specified in ``payment-methods/payment-method/payload`` to.
|payment-methods/payment-method/payload/payload-field[@field-name] |  |C |  |String |  a|
Only if ``transaction-state`` is ``success``. +
This is the input field name of the form that the merchant has to submit
to the _Paylib_ URL (``payment-methods/payment-method[@url]``).
|payment-methods/payment-method/payload/payload-field[@field-value] |  |C |  |String |  a|Only if ``transaction-state`` is ``success``. +
This is the input field value of the form that the merchant has to
submit to the _Paylib_ URL (``payment-methods/payment-method[@url]``).
|requested-amount |M |M |M |Decimal |18,2 a|
This is the amount of the transaction. +
The amount of the decimal place depends on the currency. Minimum is
0.01.
|requested-amount[@currency] |M |M |M |String |3 |This is the currency
in which a transaction is received and processed.
|account-holder/first-name |O |O |O |String |  |This is the first name
of the consumer.
|account-holder/last-name |O |O |O |String  |  |This is the last name of
the consumer.
|account-holder/email |O |O |O |String |  |This is the consumer's
email-address.
|card-token/token-id |  |  |M |String |36 |This is the token
corresponding to "card/account-number" of a consumer. It is mandatory if
"card/account-number" is not specified. It is unique on the instance of
EE.
|card-token/masked-account-number  |  |  |M |String |36 |This is the
masked version of "card/account-number" of a consumer. E.g.
440804\*\*****7893
|descriptor |  |  |M |String |64 |Description on the settlement of the
account holder's account about a transaction. The following characters
are allowed: 0-9, a-z, A-Z.
|api-id |O |O |O |String |  |A unique identifier assigned for every API.
|processing-redirect-url |O |O |C |String |256 |The URL a consumer is
redirected to after he has fulfilled his payment. This is normally a
page on the merchant's website.
|success-redirect-url |O |O |C |String |256 |The URL a consumer is
redirected to after a successful payment. This is normally a
success-confirmation page on the merchant's website.
|cancel-redirect-url |O |O |C |String |256 |The URL a consumer is
redirected to after he has canceled a payment. This is normally a page
on the merchant's website.
|fail-redirect-url |O |O |C |String |256 |The URL a consumer will be
redirected to after a failed payment. This is normally a
failure-confirmation page on the merchant's website.
|notifications/notification[@url] |O |O |O |String |256 |The URL to be
used for the IPN. It overwrites the notification URL that is set up in
the merchant configuration.
|custom-fields/custom-field[@field-name] |  |  |M |String |36 |This is
the name of the custom field.
|custom-fields/custom-field[@field-value] |  |  |M |String |256 |This is
the content of the custom field. With this field the merchant can send
additional information.
|authorization-code |  |  |C |String |36 |Output for _authorization_.
|transaction-state |  |M |M |String |7 |This is the status of the
transaction. Should be ``success`` or ``failed``.
|statuses/status[@code] |  |M |M |String |  |This is the code of the
status of a transaction (e.g. 201.0000).
|statuses/status[@description] |  |M |M |String |  |This is the
description of the status code of a transaction.
|statuses/status[@severity] |  |M |M |String |  |Transaction status
severity. Should be ``information`` for successful transactions, ``error``
for failed ones.
|completion-time-stamp |  |M |M |Date time |  |This is the time-stamp of
the get-urltransaction.
|provider-transaction-reference-id |  |  |O |String |  |Transaction ID
ofprovider.
|parent-transaction-id |  |  |M |String |36 |Parent transaction ID (in
this case of the get-urltransaction).
|signature |  |  |O |String |  |Standard enveloped XML signature
according to XSD http://www.w3.org/2000/09/xmldsig
|===

[#Paylib_Samples]
=== Samples

[#Paylib_Samples_debit]
==== _debit_

.XML Debit Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/paylib_debit_request_success.xml[]
----

.XML Debit Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/paylib_debit_response_success.xml[]
----

.XML Debit Notification (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/paylib_debit_notification_success_c651ffd1.xml[]
----

.XML Purchase Notification (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/creditcard_purchase_notification_success_1e943abb.xml[]
----

.POST form containing payload information
[source,html,subs=attributes+]
----
<!DOCTYPE html>
<html>
    <body>
        <form name="sendMSERes" action="https://ssl-liv-paycore.ewallet.aw.atos.net/interbank-pay-core/payment/register.do" method="POST">
            <input type="hidden" name="MSEReq" value="eJztWdlu40iyfTfgf2jUPArdXERS4sDluclFXCSS4i7qjfsibiIlbl8/KbvKVV1dPXemMbhPV5ChXCMyIyPjnEi//GOqyl+GuOvzpv78CfsN/fRLXIdNlNfp50+2tft1++kfry+KyRvx9fWlirsw8+ubVOe33C/z3r/BeWbcP6bDEfe4v/2SR58/kQSB0iSNUxS5wWn80+tL997LNvUtnm6vL3n0ZfzrD2NfkG9d30Y13esWx8g1ull/NwC2vvRxHcWdlVfxK45i9K8o/iuOWujm7/C73r4g3/W/ID+uAvbZfdx9q1d+Xr4WTVb/FjXx/7xVfwub6gV573lJ8q6/1T4UJsNBL8i3+kvpfylxTfyCfNTg1B+UfLXid7ZQvjS9oo8PRVGPTX40vgR5DcLrPe/i7hV/+7wg37e9IH+Q2fpzFf9Oh9X5df+KUyhKbPD1mnyoeG978avmXt9+V3nFUPQF+VJ+Ce9dB/1ifqU30KQftZd4apsaqnmFC/oof532RV7k3+Ivur87n+37+fwGt7tCsb8/lH0b+HKb2y9F2P6t8oL8uC3k33HJ1xczT2v/du/iX6C/1/3nT9nt1v4dQcZx/G1c/9Z0KYLDlSAojcABUZ+nf/v0PiuOpDppXl9Yv27qPIQaljcNSnzLmugXUKZNl9+y6k9EYgiGPkT+Gk/hryFG1H/7hHy3nH9Tyu8W1vX+r33mYw9BRpzEj6OIf7EN6fOnv/3x3nF5Ci3wV/R81fEuwfHLe/wqhn6wlJN+yA7WVoi4PIlCoQCr1VH//IJ8P/IF+VgbLH9vyY/Nvw+cdvfSbxUlqvXaT7Gai73NcojmwwrvVm67r5elLs839t7TdevdL2WVSYOXx9yFuWSry3C02nLlGjRocfb5yUe35X42BcNy801s4lda2yUWkpqqcGPlBKOCJtVHXQMhdcCp9Q2nQyxwrlfbmPOzbExWlxJuy7MdJmrPT4skOTv56JvcTitpNrLIE9Z1q21uKzJzCvYHYUwV9nJJnDE2uH1bIpOjNCBXldHN1+1+wmS3vuuYTV2856eryPOtwKY0YV7Xw3VpjouZKLHKrKqAq1lvpXPVysF212QStsG9lEpaXeu33ETVpsOSwCqiNJpkMi1lKA0JDUPZ7Etno+Fh1VwriR71vrAv3t235TsOVKdZpZ8/vxv/O4O/7OP5/SROJEpz/s1/L7Fxd8sT6OK3+FWRJNHmWJYp8hSMEgNSSZc81VEzcL2yKXh8bK11LQ6oTHq5ZpdcoEeUAXq/AxzL3Av+oICLADCbf35iMoV1HGXaFcBmUtVhQGNxtnOPRBkL13ov8eXdm4lpz4Hqvb+3REwtzyazjtbh/eySaFg7S8SS9+en80kfAsGpPXe8RYIzBydl0iyw/jpTYbNib4JZ4fhZ4v+gJT2YTBWspdQ7OSh0GIGe/VNbnlkGC3E7DXCyjy3+rrDj2+rBpJTGh36GO59k1HfPrYfv4C99l/gdFgnZEFYllBab4Cbx42QuIN6N6KRx/KQUUAanwN/Mh22Pdb23WfCviHxF2E7sAuT39XsWuJxNRd+Oz0+c7nGOrov8eLYMW1VMm5j4Auhfbcg6EdQ7XQKhvJ8tfqNwl69rnm1hR8L2/ODIOx117Ocnh7dvNl7WQQVHzyihFDymLGCtzGQZ4bse2hQ9VLtF47y1OpN3aOcxTflcAajAmlfBlII1p/PwjG3w/AQIieFG8BixBw30EJ3b86R7PYRz5khZXyEb+ZIiGl4wjSzv+cQjIjk5ce2Uj3vkBGo0cQDnRu7leHh+up+QgBMzDk2vCWK1t7u/dJlO7KeOEvdinsX1SvTzMc3OZHfxWU+purndCNRoX25kzbDj2e6AlA3LYZKfn8idTxMHl5V7CpHZLGHLyDvekiLtd9HNFQTeJsaiFdlmyA+zrXfUnd3EYotkaubuDrJ6KhDJydcpSnK75ydWMmZjCbiTRW8EbmXnpXe9HazMuiAVKE7odQSX0+CO81qWvaunlZuBIUB9rBYpFcPhBAa0zfe50l9n9fnpVCXCfPeShScwQt22WNXf99lpPhF21m34rtZV2oqvhtG3uzW53GVL3tR3VQWpwgAgFGmq+fB2cmUBaHizoCeIBs+rBUDTQta9U9n7rnSzLw5nOIZtmJjlu9Hdd8n6YKWzYtmLwoXLoXLWnjv18Izv3kkh1CJcPz8dKugJ8NaDJBTYvBeArjNYfWEZIPFpKtaMJDHEKGZADIHjifaY+bqa7vZUeg+cZbK20AE1MRtlPT1BaZR2FfXQQscRRotdrSgZeJQYoACTYwSQ86A/s/jmdjXm3XmTG5vTgbzbPV6YzI5C6VRR9qlY0EjRPj/x1JaVdNYO271hVSjp0tF5WtudfPGsLi771ihYUajNYVGWvomqATBrIEXYsIrOyTFXdLJMhkS9I5gPT8HAPBxBr5inCCg10HEjKcfH0s4LJ+nqFhZ1DvDpaKRSBo6VHEmsGKf6jGYl6bKuQWUeZ4Vcn4bzGXrvBmMqLjyu8bB77GoQ5f0YrC6WJAQYpH6WQAlbLwjO49Ec9UJJTuo0OkDTSwJEOuPugO8f6ITdqEfs+YkIML4vNqJR++QgX4yTwg2lnDlYU+trHS7NDceZ5xNY4sHICAqvsxJY6Nsgkemx6aJRoxt55Z8HJoUeEppI3ZxyqV1IMmVLFmQLyBmpO61yTF4lo5XzAtZbdXwD2tRvpkRziSIy+EBvtzfJxXUGB4fhvN6MyfNTXgvYhdSLkrqaMRoSDmnvr9ihEVrWPXO+Jt6E3Ycdj5cvdgxHQ5dSHvVv22Panuo1yiQhjOQ8UnS+F6y2riqHZL7KMPMcKJKeaA08a24lYNmoDVk/DJeNboe8lZZhNDRn2hXvIrKtuct24/d47S1A+3IX9C0Dki0MUgrL+GDkRxhBDbRkwDiyqSftR49hdFuEmDYq730JjB7jvgBNw/qpLHm5LxowkodcMxxwdQ5YsgxqY45OKvp2P1ga3ppzGXC77lDBfo45vGk2AW9wDKtwnsBWrGACQVhV4x5GSxjJ35Et7ZiU3zF6yALD8x963rRAjIvmP2iZQ4EfWeAJZ4JXgC6xipAKLNsLMPbq9o4ZeYbZjaNbgOI7ySPwvNOHZJyG9xr8Dj8fUR3u/MMSz08K2AsynqGRCKjDTGe+y/84Y3jbras2nlvelcLG4c7LsADJ+84VXuCAmzImJGBNzaDrYLKOW3qDHRM1oaJ0SltlWED0fkIEv0t1e7Mx6e268tOD456tNBSR095U8s2QhSOrv52MBc8USCP4GccAGgt0HlyFYk7P3aG9zEyW+UYcjoh01jxxkhLM43Aq5o+YdjaSW5o/P1Gq1UnL2TI9RIV+RtUTcaeuIb/fACChlKBp/tr3ukLeAxwHjsz77ZWq2h3uVZ1l+94+EaA+Vltg6Hh+muuBGXj35qPkeLKJ8pSqqbufKGuCCWBxxEphhJDst0k2IbY1WYuqymNqSZZYrUFkzhfWIjFol8gXYbS0IruldqVziPx+G8/dWg7Xl/BcglwaMGNGFO3csNylNsbToTNSzDmYZaldjjDNGrEztnCBTCuTedEy14drC9MdtcuAM7Jir4GZsIrLXWXJ+Sa1fAS2MCGo1GSvIVMfO0iziejxwF8cg/HYkwCoWj/Lxw48yOOPzPBnVHEHFggaq/tXqsjbkZpuip9Tw+E7avgjMXwc+F+nhj8Sw+enP6eGgPzfqOGPxBBKe6eGj9lfaVb7HTU0A5xGJR5ejNpoz1VZeCejDXAi1T+kGaTEoqmxSDAkiFmoKpYOqaEEYTkcVYtH3Udb8db2BtPKIs1u8Xs6/TMyDanif8lmD4s9P/1VOv0zMg1J8V+k09/INPQuUxohHYbkbt+cIdELVXj9YQADHCSgR/AgLXrDwjID1AYpb4x6N2mepHvy1N70TTmXXtQyZ0yRrynrF2WE7N0heH6aVnwm7xsKlTBRog+3MAvGiymapyAmTCrnik1sKFVxXHLXOhxkutwWqzHQT/e0igHJWvF6ktNZbvJ2iCGt2CpTJTb3xAYH9L5doZu9cm1o6ZpsAcWWHjPE+AW72uEMI4qTahA9CSxul9g1Gnt2iUxZ2fGVEAx9Lh657Fqfus1V2Ov4Vt7P92yWiqU1EySKA08J6wQkZHh0175DXAp8DMzlOocrWzfKyRByylhGnnJw6jgASCvoycXrQbrvDAIxtoWk7aPFcDC15+5TkYWtuuoiRufzO6nj+wYL1IS0BHMrGT1/7ac2F22iw42ehaD6oP/+IwBfHvR/pwDicbYRByEJGWFUhlGAKcDxnZwqPPu4L7qIgJQHMBF6A7EPCGNDeBdk6y+AGPgK35dRXkDZsFoqeR4kKd9m/hS+a6VSs3foBpuv0K1yb1FBYHZ2JAEwfgXsB634zyBbfAcvjWE8fift81C0omGnIMt6gEkYvcWQFucE9gJDOrN9s5s06p4C2cpOaGe57nTxTtPkcmvtyOiL80rnK7/7MQljx69JGNABIjJtgKAgF70txrH4tTLjbmT4OVRDfC/AUBTwdWXvVxOM6uYu4kLzyJM2desu6nCpg50QI/vnp0GgWYvx/ex64TUlKrdHWyH4LmmGThMyoamFCxyCXInisCyXeWukkEl6nJHh93zBBztB1pi3k2uHYm7PT6hrMDsBRb07KgSsNTPd2IDrljuE0sIkw+GaBc3ZYDjaLUOC2HlViHXophDjqXRmm9NixyVCom5PPFM9P+mTjDCbrHRurjpSCdYH57LuWU6tt65hTahJavvjke9oyxnD9VCnqTkJcqph8jQIw7JtF628b3pvi98omIRZe5HG0ZLUIPHJ+Zi3AzVKycGi9CzUr3w7o/jVTnP7RLH/HgTyxwKGoNn/gECz1JT9n7yO/D8EfgeB3GVUH68QVjirlv0OgcvjZeStDXtrK/61zf7vIPA/t9kHBP5XbPZ4j3kw9j++yPzxPYalssN5xklC8Vf7M2UBpl0HV6XLHd3oZLzaaa54OD4/IYPPxgG9eLq3h+Di9RhiGTYRhrezpgzynKfIOp1q3W9YmHHaca8kddVtTWcOwwZPB7aJab/qtVN1WuCZiomDSa4asgLaL4c6pw5OVlzYPihMY7u5zHbNa1QSrzCDdjabkRI2ULtEsdgpt+XUVTI1PKwzdwz3MFz2iOyTbOzXs3Wa7otezS5LbBd24k+7Qo4opuqv/HnVshUpaTgSYAx/1of4yGwQzMZW4XHQTwft3HY8Ae+CJchrCsYzMujRgakOXTsZ5CZa3RxtUuZDGYT0eGQ6imhv9a05ooXvDt5lUold3p853QRIjhdnA+YHBvSQry8yevF40fiXEPiek1owk4EwqDDo+9hUdxnGuIb5GYYklNkMSRxufEe0AwlPLoxcXZc/z3zi8zYqex+PrW1eeImVjQrvCW1X5eQZ5uknxej4o0EbR6SwLt143NPWmlWuJnLdbfWDI29sgfQ9ZZmbzt3nQPQ7F+Z2TIatpkPJF+d84G8wso8NlGZckoVCogJizk7fn8wbYmJV4SNXL8NzYDgMew+z9dZXl2l18G0fV0351F/pjsN6XMAHLFFxbotucu6RhdXubFW9Tg+EFJytVcVh+BXR3HkXXrEu9LfHiOUprRHCjlE1SyaGhTBqcL/U5ybbImzALgyBb8UwQ4+rB2hp/tyfWFGpxSLZbvgylcjOozdi01vDnSt7QjkKleiI2iXc7i0E4/WOcWwQFVsmEOTmRKMp2coYPWnwnhKtFBC3HZ3+NPdBvr2YIx+v6N/e12H5y39K/wlVwpZZ">
            <input type="hidden" name="returnURL" value="https://{test-instance-hostname}:443/engine/notification/paylib?payment.transaction-id=40709893-46da-42c1-80d9-97ce1e7ea356&amp;payment.transaction-type=debit">
            <input type="hidden" name="internalContext" value="wirecard">
        </form>
        <script>document.sendMSERes.submit();</script>
    </body>
</html>
----

NOTE: Use the form parameters ``MSEReq`` and ``returnURL`` from the debit
response.

//-
