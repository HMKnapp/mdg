[#Boleto]
== REST API
_Boleto_ is a type of <<PaymentMethods_PaymentMode_OfflineBankTransfer, Offline Bank Transfer>>.

[#Boleto_General_PaymentMode]
=== Countries and Currencies
[width=75%,cols="1h,3",stripes=none,]
|===
|Countries    |Brazil
|Currencies   |BRL
|===

[#Boleto_General_Communication]
=== Communication Formats
This table illustrates how _moip_ notifications are encoded and which
formats and methods can be used for requests and responses.

[width=75%,stripes=none]
|===
.2+h|Requests/Responses |Format  |XML
                        |Methods |POST

h|IPN Encodement 2+|Base64
|===

[#Boleto_TransactionTypes]
=== Transaction Types

For <<Glossary_TransactionType, transaction type>> details look at <<AppendixB,  Transaction Types>>.

[%autowidth.strech,stripes=none]
|===
|Transaction Type |Link to the sample

|debit            |<<Boleto_Samples_Debit, _debit_ sample>>
|===

[#Boleto_TestCredentials]
=== Test Credentials

[%autowidth.strech,stripes=none,cols="h,"]
|===
|URLs (Endpoints)           |``\https://{test-instance-hostname}/engine/rest/paymentmethods/``
|Merchant Account ID (MAID) |8a940e2a-5d7e-468b-8b27-d16a50814a02
|Username                   |16390-testing
|Password                   |3!3013=D3fD8X7
|Secret Key                 |807b6727-c199-4fc6-b663-788d577d1bea
|===

[#Boleto_Workflow]
=== Workflow

[#Boleto_Workflow_Debit]
==== _debit_

image::images/11-06-boleto/Boleto_Debit_Workflow.png[Boleto Debit Workflow]

. Merchant sends the payment request to _{payment-gateway-abbr}_.
. {payment-gateway-abbr} creates the order request and sends it to _moip._
. _moip_ sends the order response with status _Created_ to _{payment-gateway-abbr}_.
. {payment-gateway-abbr} creates the payment request (related to previously created
order) from appropriate {payment-gateway-abbr} payment fields and sends it to _moip._ It
can be used to modify some payment fields, e.g. expiration date or
payment slip instructions.
. _moip_ sends the payment response with status _Waiting._
. {payment-gateway-abbr} stores the ``get-url`` transaction and sends the payment response
with redirect URL to the consumer.
. {payment-gateway-abbr} redirects consumer to the appropriate page (a bank) to print out
a _Boleto_ slip.
. {payment-gateway-abbr} stores a ``pending-debit`` transaction and waits for a notification
from _moip_ about the payment.
. After the payment, {payment-gateway-abbr} creates a final transaction and notifies
merchant about the payment.

//-

image::images/11-06-boleto/Boleto_Debit_Workflow_receipt.png[Boleto Debit Workflow Receipt]

[#Boleto_Workflow_Refund]
==== _refund_

image::images/11-06-boleto/Boleto_Refund_Workflow.png[Boleto Refund Workflow]

.  Merchant requests the refund.
.  {payment-gateway-abbr} creates ``refund-request`` and sends it to _moip._
.  _moip_ sends the _refund_ response with status _Requested._
.  After _moip_ processes the refund, Merchant is notified.

//-

[#Boleto_Fields]
=== Fields
The following elements are mandatory *M*, optional *O* or conditional
*C* for sending a request/response for the Payment Method _Boleto._

[%autowidth,stretch,stripes=none]
[cols="e,,,,,,,,"]
|===
|Field name |Debit Request |Debit Response |Refund Request |Refund Response |Merchant Notification |Type |Size |Description

|merchant-account-id                                             |M |M |M |M |M |String    |36   |Unique identifier for a merchant account.
|transaction-id                                                  |  |M |  |M |M |String    |36   |The Transaction ID is the unique identifier for a transaction. It is generated by Wirecard.
|request-id                                                      |M |M |M |M |M |String    |36   |Identification number of the request. *It has to be unique for each request.*
|transaction-type                                                |M |M |M |M |M |Enum      |30   |Type of a transaction. Must be ``debit``.
|parent-transaction-id                                           |  |  |M |M |C |String    |36   |Unique identifier of parent transaction.
|transaction-state                                               |  |M |  |M |M |String    |12   |Status of a transaction.
|completition-time-stamp                                         |  |M |  |M |M |Date time |     |Timestamp of completion of request.
|statuses.status[@code]                                          |  |M |  |M |M |String    |12   |Code of the status of a transaction, e.g. ``201.0000``.
|statuses.status[@description]                                   |  |M |  |M |M |String    |256  |Description to the status code of a transaction.
|statuses.status[@severity]                                      |  |M |  |M |M |String    |20   |Transaction status severity. Should be *information* for successful transactions or *error* for failed.
|payment-methods.payment-method[@name]                           |M |M |M |M |M |Enum      |     |Name of the Payment Method is _Boleto._
|requested-amount                                                |M |M |O |M |M |Decimal   |18,2 |Amount of the transaction. The amount of the decimal place is dependent of the
currency. Minimum is ``0.01``. In case of refund, if no amount is specified, this implies a complete refund. If a smaller amount than in the original debit is
specified, a partial refund is done. Any subsequent partial refund must have a specified amount.
|requested-amount[@currency]                                     |M |M |C |M |M |String    |3    |Currency of the transaction. _Boleto_ supports only ``BRL``.
|order-items.order-item.name                                     |M |M |  |M |M |String    |     |Basket item name. Mandatory for each instance of ``order-item``.
|order-items.order-item.amount                                   |M |M |  |M |M |Decimal   |     |Basket item amount. Mandatory for each instance of ``order-item``.
|order-items.order-item.amount[@currency]                        |M |M |  |M |M |String    |3    |Basket item amount currency. _Boleto_ supports only ``BRL``.
|order-items.order-item.quantity                                 |M |M |  |M |M |Number    |     |Basket item quantity. Should be greater than zero. Mandatory for each instance of ``order-item``.
|account-holder                                                  |M |M |C |M |M |Complex   |     |Account holder information. This element is required only if debit request does not contain ``social-security-number`` element.
|account-holder.first-name                                       |M |M |M |M |M |String    |     |First name of the end consumer.
|account-holder.last-name                                        |M |M |M |M |M |String    |     |Last name of the end consumer.
|account-holder.email                                            |O |O |O |O |O |String    |     |End consumer's email address.
|account-holder.date-of-birth                                    |M |M |M |M |O |String    |     |End consumer's birth date.
|account-holder.social-security-number                           |M |  |M |  |M |String    |     |Tax number. If set in Required in Refund request only if not present in Debit request.
|shipping.first-name                                             |M |M |  |M |M |String    |     |Buyers first name.
|shipping.last-name                                              |M |M |  |M |M |String    |     |Buyers last name.
|shipping.email                                                  |M |M |  |M |M |String    |     |Buyers email address.
|api-id                                                          |O |O |  |  |  |String    |     |A unique identifier assigned for every API.
|expiration-date                                                 |M |M |  |  |M |Date time |     |Expiration date of payment. *The expiration date of the tickets generated via this API is 5 calendar days from the creation date.*
|custom-fields.custom-field[@field-name]                         |O |O |  |  |O |Enum      |     |Name of the custom field. _Boleto_ supports ``instruction-lines.first/second/third`` or ``logo-uri``.
|custom-fields.custom-field[@field-value]                        |C |C |  |  |C |String    |     |Content of the custom field. In this field the merchant can send additional information to consumer about payment.
|bankAccount.bank-code                                           |  |  |M |M |M |String    |     |Bank number (Febraban standard).
|bankAccount.agency-number                                       |  |  |M |M |M |String    |     |Agency number.
|bankAccount.agencyCheckNumber                                   |  |  |M |M |M |String    |     |The bank branch verifier digit.
|bankAccount.accountNumber                                       |  |  |M |M |M |String    |     |Account number.
|bankAccount.accountCheckNumber                                  |  |  |M |M |M |String    |     |The bank account verifier digit.
|bankAccount.type                                                |  |  |M |M |M |Enum      |     |Bank account type. Should be ``CHECKING`` or ``SAVING``.
|===

[#Boleto_Samples]
=== Samples

[#Boleto_Samples_Debit]
==== _debit_

.Debit Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/boleto_debit_request_success.xml[]
----

.Debit Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/boleto_debit_response_success.xml[]
----

//-
